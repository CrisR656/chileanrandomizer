<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Chilean Spirit Guide</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #d52b1e; /* Chilean flag red */
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .question-container {
            margin-bottom: 30px;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .question {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #003399; /* Chilean flag blue */
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .option:hover {
            background-color: #e0e0e0;
            transform: translateX(5px);
        }
        
        .option.selected {
            background-color: #d52b1e;
            color: white;
            border-left: 4px solid #003399;
            transform: translateX(10px);
        }
        
        .profile {
            display: none;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 1s;
        }
        
        .profile-image {
            width: 250px;
            height: 250px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 5px solid #d52b1e;
        }
        
        .profile-info {
            text-align: center;
            max-width: 600px;
        }
        
        .name {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #003399; /* Chilean flag blue */
        }
        
        .zodiac {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 15px;
            color: #d52b1e; /* Chilean flag red */
            display: inline-block;
            padding: 5px 15px;
            background: #f0f0f0;
            border-radius: 20px;
        }
        
        .description {
            margin: 25px 0;
            font-size: 1.1rem;
            line-height: 1.7;
        }
        
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 15px;
        }
        
        button {
            background-color: #d52b1e;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            flex: 1;
            max-width: 200px;
        }
        
        button:hover {
            background-color: #b52219;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .back-button {
            background-color: #666;
        }
        
        .back-button:hover {
            background-color: #444;
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin: 30px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #003399, #d52b1e);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #666;
        }

        .intro-container {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1s;
        }
        
        .intro-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            max-width: 600px;
            margin: 0 auto 30px auto;
        }
        
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .match-explanation {
            margin-top: 25px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            text-align: left;
            font-style: italic;
            border-left: 3px solid #003399;
        }
        
        .match-traits {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .trait-badge {
            background-color: #003399;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .results-header {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            color: #003399;
        }
        
        .category-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #003399;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        
        .divider {
            height: 6px;
            width: 100%;
            margin: 30px 0;
            background: linear-gradient(to right, 
                #003399 0%, #003399 33%, 
                white 33%, white 67%, 
                #d52b1e 67%, #d52b1e 100%);
            border-radius: 3px;
        }
        
        .filter-container {
            margin: 20px 0;
            text-align: center;
        }
        
        .filter-button {
            background-color: #f0f0f0;
            color: #333;
            border: none;
            padding: 8px 16px;
            margin: 0 5px 10px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .filter-button.active {
            background-color: #003399;
            color: white;
        }
        
        /* Gallery styles */
        .gallery-container {
            display: none;
            flex-direction: column;
            animation: fadeIn 1s;
        }
        
        .gallery-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .gallery-item {
            background-color: #f9f9f9;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 3px solid #d52b1e;
        }
        
        .gallery-item-content {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .gallery-item-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #003399;
        }
        
        .gallery-item-category {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #003399;
            color: white;
            padding: 3px 8px;
            font-size: 0.7rem;
            border-radius: 10px;
            text-transform: uppercase;
        }
        
        .chilean-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: white;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 10px;
            padding: 30px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .choose-button {
            background-color: #d52b1e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .choose-button:hover {
            background-color: #b52219;
        }
        
        .intro-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .search-box {
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ccc;
            margin-right: 10px;
            width: 200px;
        }
        
        /* Mobile responsiveness improvements */
        @media (max-width: 600px) {
            .button-container {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: none;
                margin-bottom: 10px;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .filter-button {
                margin: 3px;
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .search-box {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .question {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Your Chilean Spirit Guide</h1>
        
        <div class="intro-container" id="intro-container">
            <div class="intro-text">
                <p>Discover which notable Chilean figure is your spiritual match for the May 13th picnic!</p>
                <p>Take the quiz to find your match or browse the gallery to choose your own Chilean guide.</p>
            </div>
            <div class="intro-buttons">
                <button id="start-button">Take the Quiz</button>
                <button id="view-gallery-button">Browse Gallery</button>
            </div>
        </div>
        
        <div id="quiz-container" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-labels">
                <span>Question 1</span>
                <span id="current-question-label">1 of 5</span>
            </div>
            
            <div id="questions-area"></div>
            
            <div class="button-container">
                <button id="back-button" class="back-button" disabled>Previous</button>
                <button id="next-button" disabled>Next Question</button>
            </div>
        </div>
        
        <!-- Gallery Container -->
        <div class="gallery-container" id="gallery-container">
            <div class="gallery-controls">
                <input type="text" id="search-box" class="search-box" placeholder="Search Chileans...">
                <button class="filter-button active" data-category="all">All</button>
                <button class="filter-button" data-category="literary">Literary</button>
                <button class="filter-button" data-category="musical">Musical</button>
                <button class="filter-button" data-category="visual_artist">Visual Artist</button>
                <button class="filter-button" data-category="performer">Performer</button>
                <button class="filter-button" data-category="political">Political</button>
                <button class="filter-button" data-category="sports">Sports</button>
                <button class="filter-button" data-category="heroic">Heroic</button>
                <button class="filter-button" data-category="unique">Unique</button>
            </div>
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery items will be dynamically added here -->
            </div>
            <div class="button-container" style="margin-top: 30px;">
                <button id="back-to-intro-button" class="back-button">Back to Menu</button>
            </div>
        </div>
        
        <!-- Chilean Detail Modal -->
        <div class="chilean-modal" id="chilean-modal">
            <div class="modal-content">
                <span class="close-modal" id="close-modal">&times;</span>
                <img id="modal-image" class="profile-image" src="/api/placeholder/250/250" alt="Chilean figure">
                <div id="modal-name" class="name"></div>
                <div id="modal-zodiac" class="zodiac"></div>
                <div id="modal-category" class="category-badge"></div>
                <div id="modal-description" class="description"></div>
                <button id="choose-chilean-button" class="choose-button">Choose as My Guide</button>
            </div>
        </div>
        
        <div class="profile" id="profile">
            <div class="results-header">Your Chilean Spirit Guide Is...</div>
            <img id="chilean-image" class="profile-image" src="/api/placeholder/250/250" alt="Your Chilean Spirit Guide">
            <div class="profile-info">
                <div id="chilean-name" class="name"></div>
                <div id="chilean-zodiac" class="zodiac"></div>
                <div id="chilean-category" class="category-badge"></div>
                <div class="match-traits" id="match-traits"></div>
                <div id="chilean-description" class="description"></div>
                <div id="match-explanation" class="match-explanation"></div>
            </div>
            
            <div class="button-container">
                <button id="restart-button">Try Again</button>
                <button id="share-button">Share Result</button>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="footer">
            <p>Happy Birthday! May 13th picnic - come dressed as your new favorite Chilean!</p>
        </div>
    </div>
    
    <script>
        // Array of notable Chileans with their information
        const chileans = [
            // Literary Figures
            {
                name: "Gabriela Mistral",
                image: "images/gabriela-mistral.jpg",
                description: "The eternal spinster, this bisexual vixen wrote some of the most enduring lines in Spanish-language poetry and looked stylish every step of the way. She Christened Chile her 'country of absence'.",
                zodiac: "Aries (April 7, 1889)",
                category: "literary",
                traits: {
                    demeanor: "composed",
                    expression: "poetic",
                    politics: "moderate",
                    passion: "deep"
                },
                relatedTraits: {
                    demeanor: ["reserved"],
                    expression: ["disciplined", "grandiose"],
                    politics: ["harmonious", "artistic"],
                    passion: ["idealistic", "intense"]
                }
            },
            {
                name: "Isabel Allende",
                image: "images/isabel-allende.jpg",
                description: "In the grand tradition of Corín Tellado, Allende writes to inspire the Latin American masses. She has serious billionaire mom vibes. She lives in Miami, and like most people in the god-forsaken state of Florida, and has turned increasingly right-wing.",
                zodiac: "Leo (August 2, 1942)",
                category: "literary",
                traits: {
                    demeanor: "expressive",
                    expression: "popular",
                    politics: "traditional",
                    passion: "steady"
                },
                relatedTraits: {
                    demeanor: ["composed"],
                    expression: ["disciplined", "poetic"],
                    politics: ["harmonious"],
                    passion: ["deep", "idealistic"]
                }
            },
            {
                name: "Juan Luis Martínez",
                image: "images/juan-luis-martinez.jpg",
                description: "The reclusive avant-garde poet who never showed his face in public and published books designed to make you question reality. A hipster's Chilean before hipsters were a thing.",
                zodiac: "Gemini (June 7, 1942)",
                category: "literary",
                traits: {
                    demeanor: "reserved",
                    expression: "experimental",
                    politics: "artistic",
                    passion: "cerebral"
                },
                relatedTraits: {
                    demeanor: ["composed"],
                    expression: ["provocative", "grandiose"],
                    politics: ["chaotic", "revolutionary"],
                    passion: ["intense", "deep"]
                }
            },
            {
                name: "María Luisa Bombal",
                image: "images/maria-luisa-bombal.jpg",
                description: "A modernist literary powerhouse whose surrealist stories of women's inner lives were decades ahead of their time. Shot her ex-lover in a fit of passion then transformed the experience into haunting fiction exploring female desire and alienation.",
                zodiac: "Gemini (June 8, 1910)",
                category: "literary",
                traits: {
                    demeanor: "intense",
                    expression: "surreal",
                    politics: "artistic",
                    passion: "intense"
                },
                relatedTraits: {
                    demeanor: ["expressive", "provocative"],
                    expression: ["experimental", "poetic"],
                    politics: ["revolutionary", "chaotic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Nicanor Parra",
                image: "images/nicanor-parra.jpg",
                description: "The anti-poet who lived to 103 and trolled the literary establishment the entire time. Wrote poems about how poetry sucks. Defined his work as 'a roller coaster ride that leads to nothing.' The original literary shitposter.",
                zodiac: "Virgo (September 5, 1914)",
                category: "literary",
                traits: {
                    demeanor: "provocative",
                    expression: "ironic",
                    politics: "chaotic",
                    passion: "playful"
                },
                relatedTraits: {
                    demeanor: ["confrontational", "expressive"],
                    expression: ["provocative", "experimental"],
                    politics: ["artistic", "revolutionary"],
                    passion: ["cerebral", "extreme"]
                }
            },
            {
                name: "José Donoso",
                image: "images/jose-donoso.jpg",
                description: "The bourgeois novelist who aired all of Chile's dirty aristocratic laundry. Wrote a surrealist masterpiece so complex it's the ultimate 'I've read it but I didn't understand it' book. Lived in self-imposed exile because Chile wasn't literary enough for him.",
                zodiac: "Libra (October 5, 1924)",
                category: "literary",
                traits: {
                    demeanor: "reserved",
                    expression: "complex",
                    politics: "traditional",
                    passion: "cerebral"
                },
                relatedTraits: {
                    demeanor: ["composed"],
                    expression: ["experimental", "grandiose"],
                    politics: ["artistic"],
                    passion: ["deep", "intense"]
                }
            },
            {
                name: "Rodrigo Lira",
                image: "images/rodrigo-lira.jpg",
                description: "The tragic enfant terrible of Chilean poetry who committed suicide at 32 after trolling the literary establishment with devastating parodies. His dark, experimental work blended surrealism and wordplay. Posthumously became a cult hero to disaffected youth.",
                zodiac: "Capricorn (December 26, 1949)",
                category: "literary",
                traits: {
                    demeanor: "provocative",
                    expression: "experimental",
                    politics: "chaotic",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["intense", "confrontational"],
                    expression: ["ironic", "surreal"],
                    politics: ["revolutionary", "artistic"],
                    passion: ["intense", "cerebral"]
                }
            },
            {
                name: "Roberto Bolaño",
                image: "images/roberto-bolano.jpg",
                description: "A literary nomad who fled Chile during the dictatorship and wrote feverishly while his liver failed. His sprawling novels blend high and low culture, detective fiction and academic satire. Died just before global fame hit, becoming the perfect literary martyr.",
                zodiac: "Taurus (April 28, 1953)",
                category: "literary",
                traits: {
                    demeanor: "intense",
                    expression: "grandiose",
                    politics: "revolutionary",
                    passion: "intense"
                },
                relatedTraits: {
                    demeanor: ["provocative", "reserved"],
                    expression: ["experimental", "complex"],
                    politics: ["chaotic", "artistic"],
                    passion: ["extreme", "deep"]
                }
            },
            {
                name: "Pablo de Rokha",
                image: "images/pablo-de-rokha.jpg",
                description: "The volcanic avant-garde poet who despised Pablo Neruda with the fire of a thousand suns. Known for his torrential verse, communist politics, and epic feuds. Shot himself at 73 after losing his wife and son. The OG angry poet of Chile.",
                zodiac: "Libra (October 17, 1894)",
                category: "literary",
                traits: {
                    demeanor: "confrontational",
                    expression: "grandiose",
                    politics: "revolutionary",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["intense", "provocative"],
                    expression: ["experimental", "complex"],
                    politics: ["chaotic"],
                    passion: ["intense", "deep"]
                }
            },
            {
                name: "Soledad Fariña",
                image: "images/soledad-farina.jpg",
                description: "The neo-avant-garde poet who somehow slipped through the dictatorship's censors with her experimental work exploring womanhood, prehistoric cultures, and the limits of language. Has been quietly collecting awards and blowing minds since the 1980s.",
                zodiac: "Virgo (September 15, 1943)",
                category: "literary",
                traits: {
                    demeanor: "reserved",
                    expression: "experimental",
                    politics: "artistic",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["composed"],
                    expression: ["poetic", "complex"],
                    politics: ["revolutionary", "harmonious"],
                    passion: ["deep", "cerebral"]
                }
            },
            {
                name: "Diamela Eltit",
                image: "images/diamela-eltit.jpg",
                description: "The experimental novelist who once cut herself in a brothel and called it performance art. Her dense, fragmented prose drove the dictators crazy because they couldn't understand it well enough to censor it. Academics worldwide go gaga for her.",
                zodiac: "Virgo (August 24, 1947)",
                category: "literary",
                traits: {
                    demeanor: "provocative",
                    expression: "provocative",
                    politics: "revolutionary",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["intense"],
                    expression: ["experimental", "complex"],
                    politics: ["chaotic", "artistic"],
                    passion: ["intense", "cerebral"]
                }
            },
            {
                name: "Alone (Hernán Díaz Arrieta)",
                image: "images/alone.jpg",
                description: "The acid-tongued literary critic whose weekly column could make or break a writer's career. His devastating pen name says it all—forever alone with his judgmental opinions. Could dismiss an author's entire life's work with a single snarky paragraph. The Simon Cowell of Chilean letters.",
                zodiac: "Taurus (May 11, 1891)",
                category: "literary",
                traits: {
                    demeanor: "confrontational",
                    expression: "disciplined",
                    politics: "traditional",
                    passion: "cerebral"
                },
                relatedTraits: {
                    demeanor: ["provocative"],
                    expression: ["ironic"],
                    politics: ["chaotic"],
                    passion: ["intense"]
                }
            },
            {
                name: "Elvira Hernández",
                image: "images/elvira-hernandez.jpg",
                description: "The dissident poet who wrote 'La bandera de Chile' after being detained by Pinochet's secret police. Her samizdat verses circulated underground for a decade before publishing. Took a pen name to avoid further persecution. Refuses to call herself neo-avant-garde.",
                zodiac: "Cancer (July 2, 1951)",
                category: "literary",
                traits: {
                    demeanor: "reserved",
                    expression: "provocative",
                    politics: "revolutionary",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["intense"],
                    expression: ["experimental", "complex"],
                    politics: ["chaotic", "artistic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Bruno Vidal",
                image: "images/bruno-vidal.jpg",
                description: "The poet who adopted the persona of a fascist torturer to expose Chile's collective trauma. His meticulously crafted right-wing psychopath act fooled many into thinking he was actually a monster. Literary performance art at its most disturbing and brilliant.",
                zodiac: "Unknown (birth date classified)",
                category: "literary",
                traits: {
                    demeanor: "provocative",
                    expression: "provocative",
                    politics: "chaotic",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["intense", "confrontational"],
                    expression: ["experimental", "ironic"],
                    politics: ["revolutionary", "artistic"],
                    passion: ["intense", "cerebral"]
                }
            },
            // Musical Figures
            {
                name: "Violeta Parra",
                image: "images/violeta-parra.jpg",
                description: "The quintessential Chilean folk singer, a poet of singular lucidity, a lover of unbridled passion, and perhaps the most influential Chilean artist of the 20th century. A favorite Chilean if there ever was one.",
                zodiac: "Libra (October 4, 1917)",
                category: "musical",
                traits: {
                    demeanor: "composed",
                    expression: "poetic",
                    politics: "harmonious",
                    passion: "deep"
                },
                relatedTraits: {
                    demeanor: ["reserved", "intense"],
                    expression: ["disciplined", "popular"],
                    politics: ["artistic", "revolutionary"],
                    passion: ["intense", "idealistic"]
                }
            },
            {
                name: "Víctor Jara",
                image: "images/victor-jara.jpg",
                description: "The folk singer who became a martyr when Pinochet's goons killed him in the national stadium after breaking his hands. Now the ultimate t-shirt icon and the name dropped by every leftist trying to seem cultured. His music actually slaps though.",
                zodiac: "Virgo (September 28, 1932)",
                category: "musical",
                traits: {
                    demeanor: "composed",
                    expression: "popular",
                    politics: "revolutionary",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["intense", "provocative"],
                    expression: ["poetic", "disciplined"],
                    politics: ["artistic", "chaotic"],
                    passion: ["deep", "extreme"]
                }
            },
           {
                name: "Mon Laferte",
                image: "images/mon-laferte.jpg",
                description: "The tattooed chanteuse who went from Chilean talent show contestant to Latin Grammy winner. Bounces between rock, bolero, and ranchera like she's channel surfing. Will protest topless if the situation demands it. We stan a versatile queen.",
                zodiac: "Taurus (May 2, 1983)",
                category: "musical",
                traits: {
                    demeanor: "provocative",
                    expression: "experimental",
                    politics: "revolutionary",
                    passion: "intense"
                },
                relatedTraits: {
                    demeanor: ["expressive"],
                    expression: ["popular", "poetic"],
                    politics: ["artistic", "chaotic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Jorge González",
                image: "images/jorge-gonzalez.jpg",
                description: "Fearless frontman of Los Prisioneros who wrote anthems of resistance during the Pinochet era. Part punk prophet, part electronic pioneer, he's suffered a stroke but refuses to die. The most important voice in Chilean rock, even when he can barely speak.",
                zodiac: "Sagittarius (December 6, 1964)",
                category: "musical",
                traits: {
                    demeanor: "confrontational",
                    expression: "provocative",
                    politics: "revolutionary",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["intense", "provocative"],
                    expression: ["experimental", "poetic"],
                    politics: ["chaotic"],
                    passion: ["extreme", "deep"]
                }
            },
            {
                name: "Ana Tijoux",
                image: "images/ana-tijoux.jpg",
                description: "The French-Chilean hip-hop firebrand whose socially conscious lyrics have been called the spiritual heir to Violeta Parra. Raps about feminism, inequality, and imperialism while sampling Andean folk instruments. Made Latin America fall in love with hip-hop.",
                zodiac: "Gemini (June 12, 1977)",
                category: "musical",
                traits: {
                    demeanor: "provocative",
                    expression: "popular",
                    politics: "revolutionary",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["composed", "intense"],
                    expression: ["poetic", "experimental"],
                    politics: ["artistic", "chaotic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Margot Loyola",
                image: "images/margot-loyola.jpg",
                description: "The formidable folklorist who traveled every inch of Chile documenting traditional music and dances when no one else cared. Performed and taught for seven decades. Made cuecas cool before it was cool. The spiritual grandmother to Víctor Jara and all Chilean folk.",
                zodiac: "Virgo (September 15, 1918)",
                category: "musical",
                traits: {
                    demeanor: "composed",
                    expression: "disciplined",
                    politics: "traditional",
                    passion: "steady"
                },
                relatedTraits: {
                    demeanor: ["reserved"],
                    expression: ["popular"],
                    politics: ["harmonious", "artistic"],
                    passion: ["deep", "idealistic"]
                }
            },
            {
                name: "Pailita",
                image: "images/pailita.jpg",
                description: "The Gen Z icon who went from recording songs on his phone to headlining festivals. His street cred is only matched by his ability to make middle-aged Chileans say 'what is that noise?' A cultural reset in a snapback.",
                zodiac: "Taurus (May 4, 2000)",
                category: "musical",
                traits: {
                    demeanor: "provocative",
                    expression: "experimental",
                    politics: "chaotic",
                    passion: "playful"
                },
                relatedTraits: {
                    demeanor: ["expressive", "confrontational"],
                    expression: ["popular"],
                    politics: ["revolutionary"],
                    passion: ["intense", "extreme"]
                }
            },
            // Visual Artists
            {
                name: "Roberto Matta",
                image: "images/roberto-matta.jpg",
                description: "Chile's best 20th century painter. 'Nuff said.",
                zodiac: "Scorpio (November 11, 1911)",
                category: "visual_artist",
                traits: {
                    demeanor: "reserved",
                    expression: "experimental",
                    politics: "artistic",
                    passion: "intense"
                },
                relatedTraits: {
                    demeanor: ["composed", "intense"],
                    expression: ["grandiose", "surreal"],
                    politics: ["revolutionary", "chaotic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Cecilia Vicuña",
                image: "images/cecilia-vicuna.jpg",
                description: "One of Chile's top experimental poets became one of New York's top experimental visual artists.",
                zodiac: "Capricorn (January 22, 1948)",
                category: "visual_artist",
                traits: {
                    demeanor: "reserved",
                    expression: "experimental",
                    politics: "artistic",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["composed"],
                    expression: ["poetic", "complex"],
                    politics: ["revolutionary", "harmonious"],
                    passion: ["deep", "cerebral"]
                }
            },
            {
                name: "Alejandro Jodorowsky",
                image: "images/alejandro-jodorowsky.jpg",
                description: "Deranged, or a genius? A French comics writer, an American experimental filmmaker, and a psycho-magician who uses tarot and his personality disorder to heal people, and charges a pretty penny for it.",
                zodiac: "Pisces (February 17, 1929)",
                category: "visual_artist",
                traits: {
                    demeanor: "provocative",
                    expression: "experimental",
                    politics: "chaotic",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["intense", "confrontational"],
                    expression: ["surreal", "grandiose"],
                    politics: ["artistic", "revolutionary"],
                    passion: ["intense", "deep"]
                }
            },
            {
                name: "Raúl Zurita",
                image: "images/raul-zurita.jpg",
                description: "The poetic madman who carved poems in the Atacama Desert, tattooed them on his face, and wrote them in the sky over New York. Bulldozed landscapes into verse while fighting Pinochet and Parkinson's. Calls his self-harm 'beautiful' and poetry his salvation.",
                zodiac: "Capricorn (January 10, 1950)",
                category: "visual_artist",
                traits: {
                    demeanor: "intense",
                    expression: "grandiose",
                    politics: "revolutionary",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["provocative", "confrontational"],
                    expression: ["experimental", "poetic"],
                    politics: ["artistic", "chaotic"],
                    passion: ["deep", "intense"]
                }
            },
            {
                name: "Themo Lobos",
                image: "images/themo-lobos.jpg",
                description: "The mastermind behind Chilean comic book classics like 'Mampato' who drew an entire generation into fantastical adventures through time and space. His distinctive illustration style is as Chilean as completos and earthquakes. The Walt Disney of Chile, minus the questionable politics.",
                zodiac: "Cancer (July 4, 1928)",
                category: "visual_artist",
                traits: {
                    demeanor: "composed",
                    expression: "popular",
                    politics: "harmonious",
                    passion: "playful"
                },
                relatedTraits: {
                    demeanor: ["reserved"],
                    expression: ["disciplined", "experimental"],
                    politics: ["traditional", "artistic"],
                    passion: ["steady", "idealistic"]
                }
            },
            // Performers
            {
                name: "Claudio Arrau",
                image: "images/claudio-arrau.jpg",
                description: "A pianist of incomparable style, and a model of incomparable panache. For the lover of old century formal vibes.",
                zodiac: "Aquarius (February 6, 1903)",
                category: "performer",
                traits: {
                    demeanor: "composed",
                    expression: "disciplined",
                    politics: "traditional",
                    passion: "steady"
                },
                relatedTraits: {
                    demeanor: ["reserved"],
                    expression: ["poetic", "grandiose"],
                    politics: ["harmonious", "artistic"],
                    passion: ["deep", "idealistic"]
                }
            },
            {
                name: "Rafa Araneda",
                image: "images/rafa-araneda.jpg",
                description: "The human equivalent of a TV dinner – comforting, reliable, and always the same. Has hosted every conceivable format of Chilean television and somehow still has perfect hair. National treasure or national hostage? You decide.",
                zodiac: "Pisces (March 18, 1969)",
                category: "performer",
                traits: {
                    demeanor: "composed",
                    expression: "popular",
                    politics: "harmonious",
                    passion: "steady"
                },
                relatedTraits: {
                    demeanor: ["expressive"],
                    expression: ["disciplined"],
                    politics: ["traditional"],
                    passion: ["playful", "idealistic"]
                }
            },
            {
                name: "Felipe Camiroaga",
                image: "images/felipe-camiroaga.jpg",
                description: "TV's golden boy whose tragic death in a plane crash transformed him from morning show host to literal saint. Chilean mothers still light candles to him and swoon at the mention of 'El Halcón de Chicureo.' The Elvis of Chilean television.",
                zodiac: "Libra (October 8, 1966)",
                category: "performer",
                traits: {
                    demeanor: "composed",
                    expression: "popular",
                    politics: "harmonious",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["expressive"],
                    expression: ["disciplined", "poetic"],
                    politics: ["traditional", "artistic"],
                    passion: ["deep", "steady"]
                }
            },
            {
                name: "Pedro Pascal",
                image: "images/pedro-pascal.jpg",
                description: "The internet's daddy who fled Chile as a baby and returned as a star. Built a career playing characters who protect small green aliens and fungus zombies. Has the unique power of making the entire world thirsty simultaneously.",
                zodiac: "Aries (April 2, 1975)",
                category: "performer",
                traits: {
                    demeanor: "composed",
                    expression: "popular",
                    politics: "artistic",
                    passion: "intense"
                },
                relatedTraits: {
                    demeanor: ["expressive", "provocative"],
                    expression: ["disciplined", "poetic"],
                    politics: ["harmonious", "traditional"],
                    passion: ["deep", "steady"]
                }
            },
            // Sports Figures
            {
                name: "Alexis Sánchez",
                image: "images/alexis-sanchez.jpg",
                description: "Come for the soccer. Stay for the pretty smiles.",
                zodiac: "Sagittarius (December 19, 1988)",
                category: "sports",
                traits: {
                    demeanor: "expressive",
                    expression: "popular",
                    politics: "harmonious",
                    passion: "playful"
                },
                relatedTraits: {
                    demeanor: ["composed", "intense"],
                    expression: ["disciplined"],
                    politics: ["artistic", "traditional"],
                    passion: ["intense", "idealistic"]
                }
            },
            {
                name: "Cóndor Rojas",
                image: "images/condor-rojas.jpg",
                description: "The goalkeeper who tried to cheat Brazil out of a World Cup spot by slashing his own face with a razor blade hidden in his glove and blaming it on a flare. His spectacular fraud got Chile banned from the 1994 World Cup. Football's greatest villain or misunderstood patriot?",
                zodiac: "Leo (August 8, 1957)",
                category: "sports",
                traits: {
                    demeanor: "confrontational",
                    expression: "provocative",
                    politics: "chaotic",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["provocative", "intense"],
                    expression: ["experimental"],
                    politics: ["revolutionary"],
                    passion: ["intense", "playful"]
                }
            },
            // Political Figures
            {
                name: "Salvador Allende",
                image: "images/salvador-allende.jpg",
                description: "The first democratically elected Marxist president who died in a military coup with a gun in his hand and poetry in his heart. His glasses became an icon, his economic policies a battleground. The left's eternal martyr whose last radio address still brings tears to abuelitas' eyes.",
                zodiac: "Cancer (June 26, 1908)",
                category: "political",
                traits: {
                    demeanor: "composed",
                    expression: "disciplined",
                    politics: "revolutionary",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["reserved", "intense"],
                    expression: ["poetic", "grandiose"],
                    politics: ["artistic", "chaotic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Michelle Bachelet",
                image: "images/michelle-bachelet.jpg",
                description: "The first woman president of Chile, and the one signed into law free college for the country's bottom 80%.",
                zodiac: "Virgo (September 29, 1951)",
                category: "political",
                traits: {
                    demeanor: "composed",
                    expression: "disciplined",
                    politics: "revolutionary",
                    passion: "steady"
                },
                relatedTraits: {
                    demeanor: ["reserved"],
                    expression: ["poetic"],
                    politics: ["harmonious", "artistic"],
                    passion: ["idealistic", "deep"]
                }
            },
            {
                name: "La Tía Pikachu",
                image: "images/tia-pikachu.jpg",
                description: "The revolutionary in a Pikachu costume who became the unlikely face of Chile's social uprising. Went from battling police in the streets to battling political elites in Congress. Proof that sometimes the most serious political movements come in the silliest packaging.",
                zodiac: "Gemini (May 28, 1957)",
                category: "political",
                traits: {
                    demeanor: "provocative",
                    expression: "provocative",
                    politics: "revolutionary",
                    passion: "playful"
                },
                relatedTraits: {
                    demeanor: ["expressive", "confrontational"],
                    expression: ["experimental", "popular"],
                    politics: ["chaotic", "artistic"],
                    passion: ["idealistic", "extreme"]
                }
            },
            {
                name: "Pascal Allende",
                image: "images/pascal-allende.jpg",
                description: "The revolutionary theorist and nephew of Salvador who co-founded the MIR and lived a life of exile, clandestine resistance, and ultimately political rehabilitation. Has enough dramatic stories to fill ten action movies. The family's resident true believer.",
                zodiac: "Aries (March 27, 1945)",
                category: "political",
                traits: {
                    demeanor: "reserved",
                    expression: "disciplined",
                    politics: "revolutionary",
                    passion: "idealistic"
                },
                relatedTraits: {
                    demeanor: ["composed", "intense"],
                    expression: ["complex", "grandiose"],
                    politics: ["chaotic", "artistic"],
                    passion: ["deep", "extreme"]
                }
            },
            {
                name: "Augusto Pinochet",
                image: "images/pinochet.jpg",
                description: "The dictator in dark glasses who overthrew democracy, destroyed lives, and somehow escaped justice while laundering millions. Some Chileans still claim he 'saved' the country, while most recognize he nearly destroyed it. The ironic costume choice for those who like to live dangerously.",
                zodiac: "Scorpio (November 25, 1915)",
                category: "political",
                traits: {
                    demeanor: "confrontational",
                    expression: "disciplined",
                    politics: "traditional",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["provocative", "intense"],
                    expression: ["grandiose"],
                    politics: ["chaotic"],
                    passion: ["intense", "cerebral"]
                }
            },
            // Other Notable Chileans
            {
                name: "Arturo Prat",
                image: "images/arturo-prat.jpg",
                description: "A lawyer and soldier who lost a naval battle and, in the face of defeat, called his men to rally and push forward anyway, giving a reportedly beautiful speech. He was captured and executed. For this abject failure Chile turned him into a national myth.",
                zodiac: "Aries (April 4, 1848)",
                category: "heroic",
                traits: {
                    demeanor: "confrontational",
                    expression: "grandiose",
                    politics: "traditional",
                    passion: "extreme"
                },
                relatedTraits: {
                    demeanor: ["intense", "composed"],
                    expression: ["disciplined", "poetic"],
                    politics: ["revolutionary"],
                    passion: ["idealistic", "deep"]
                }
            },
            {
                name: "Merkén",
                image: "images/merken.jpg",
                description: "Not a person but a spice that deserves personhood. This smoky Mapuche chile blend is the taste of Chilean identity in powdered form. Has colonized kitchens worldwide with its addictive flavor profile. The ultimate condiment flex—just try not to inhale while sprinkling.",
                zodiac: "N/A (Eternal Being of Flavor)",
                category: "unique",
                traits: {
                    demeanor: "provocative",
                    expression: "provocative",
                    politics: "indigenous",
                    passion: "intense"
                },
                relatedTraits: {
                    demeanor: ["intense", "expressive"],
                    expression: ["experimental", "popular"],
                    politics: ["artistic", "revolutionary"],
                    passion: ["deep", "extreme"]
                }
            }
        ];
        
        // Remove any duplicate Chileans by name
        const uniqueChileans = [];
        const seenNames = new Set();
        
        chileans.forEach(chilean => {
            if (!seenNames.has(chilean.name)) {
                seenNames.add(chilean.name);
                uniqueChileans.push(chilean);
            }
        });
        
        // Replace the original array with the deduplicated array
        const chileans = uniqueChileans;
        
        // Question configurations - enhanced with more nuanced options
        const questions = [
            {
                id: "q1",
                text: "Someone introduces themselves at a party. You respond by:",
                options: [
                    { text: "Smiling politely and making pleasant small talk", value: "composed", category: "demeanor" },
                    { text: "Launching into a detailed story about your life", value: "expressive", category: "demeanor" },
                    { text: "Observing silently before deciding how to engage", value: "reserved", category: "demeanor" },
                    { text: "Making an outrageous claim just to see their reaction", value: "provocative", category: "demeanor" },
                    { text: "Challenging them to prove they're actually interesting", value: "confrontational", category: "demeanor" }
                ]
            },
            {
                id: "q2",
                text: "If you could change one thing about society, it would be:",
                options: [
                    { text: "More respect for tradition and established values", value: "traditional", category: "politics" },
                    { text: "Greater artistic freedom and creative exploration", value: "artistic", category: "politics" },
                    { text: "Complete revolution of existing power structures", value: "revolutionary", category: "politics" },
                    { text: "Less conflict and more harmony between people", value: "harmonious", category: "politics" },
                    { text: "Nothing - chaos and conflict drive progress", value: "chaotic", category: "politics" },
                    { text: "Reconnection with indigenous wisdom and practices", value: "indigenous", category: "politics" }
                ]
            },
            {
                id: "q3",
                text: "Your approach to creative expression is best described as:",
                options: [
                    { text: "Meticulous and disciplined", value: "disciplined", category: "expression" },
                    { text: "Spontaneous and experimental", value: "experimental", category: "expression" },
                    { text: "Accessible and crowd-pleasing", value: "popular", category: "expression" },
                    { text: "Deliberately disturbing or challenging", value: "provocative", category: "expression" },
                    { text: "Monumental and grandiose", value: "grandiose", category: "expression" },
                    { text: "Lyrical and filled with emotion", value: "poetic", category: "expression" },
                    { text: "Intellectually complex and layered", value: "complex", category: "expression" },
                    { text: "Ironic and satirical", value: "ironic", category: "expression" },
                    { text: "Dreamlike and otherworldly", value: "surreal", category: "expression" }
                ]
            },
            {
                id: "q4",
                text: "Your friends would most likely describe you as someone who is:",
                options: [
                    { text: "Reliable and consistent", value: "steady", category: "passion" },
                    { text: "Intense and all-consuming", value: "intense", category: "passion" },
                    { text: "Playful and lighthearted", value: "playful", category: "passion" },
                    { text: "Driven by strong ideals", value: "idealistic", category: "passion" },
                    { text: "Unpredictable and extreme", value: "extreme", category: "passion" },
                    { text: "Profoundly thoughtful and emotional", value: "deep", category: "passion" },
                    { text: "Analytical and intellectually rigorous", value: "cerebral", category: "passion" }
                ]
            },
            {
                id: "q5",
                text: "When facing a difficult decision, you typically:",
                options: [
                    { text: "Follow proven traditions and established methods", value: "traditional", category: "decision" },
                    { text: "Take bold, unexpected actions that others might find shocking", value: "provocative", category: "decision" },
                    { text: "Analyze all options methodically before choosing", value: "disciplined", category: "decision" },
                    { text: "Trust your gut instinct and creative inspiration", value: "experimental", category: "decision" },
                    { text: "Consult widely and seek consensus", value: "harmonious", category: "decision" }
                ]
            }
        ];
        
        // Variables to track questionnaire state
        let currentQuestion = 0;
        const totalQuestions = questions.length;
        let userTraits = {};
        let selectedChilean = null;
        
        // Initialize the gallery
        function initGallery() {
            const galleryGrid = document.getElementById('gallery-grid');
            galleryGrid.innerHTML = '';
            
            // Create a gallery item for each Chilean
            chileans.forEach((chilean, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.setAttribute('data-category', chilean.category);
                
                const img = document.createElement('img');
                img.src = chilean.image;
                img.alt = chilean.name;
                img.onerror = function() {
                    this.src = '/api/placeholder/200/200';
                };
                
                const categoryBadge = document.createElement('div');
                categoryBadge.className = 'gallery-item-category';
                categoryBadge.textContent = chilean.category.replace('_', ' ');
                
                const content = document.createElement('div');
                content.className = 'gallery-item-content';
                
                const name = document.createElement('div');
                name.className = 'gallery-item-name';
                name.textContent = chilean.name;
                
                content.appendChild(name);
                
                galleryItem.appendChild(img);
                galleryItem.appendChild(categoryBadge);
                galleryItem.appendChild(content);
                
                // Add event listener to show Chilean details
                galleryItem.addEventListener('click', function() {
                    showChileanDetails(chilean);
                });
                
                galleryGrid.appendChild(galleryItem);
            });
            
            // Add filter functionality
            document.querySelectorAll('.filter-button').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.filter-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    const category = this.getAttribute('data-category');
                    
                    // Filter gallery items
                    document.querySelectorAll('.gallery-item').forEach(item => {
                        if (category === 'all' || item.getAttribute('data-category') === category) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
            
            // Add search functionality
            const searchBox = document.getElementById('search-box');
            searchBox.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                document.querySelectorAll('.gallery-item').forEach(item => {
                    const name = item.querySelector('.gallery-item-name').textContent.toLowerCase();
                    
                    if (name.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
        
        // Show Chilean details in modal
        function showChileanDetails(chilean) {
            document.getElementById('modal-image').src = chilean.image;
            document.getElementById('modal-image').alt = chilean.name;
            document.getElementById('modal-name').textContent = chilean.name;
            document.getElementById('modal-zodiac').textContent = chilean.zodiac;
            document.getElementById('modal-category').textContent = chilean.category.replace('_', ' ');
            document.getElementById('modal-description').textContent = chilean.description;
            
            // Add error handling for modal image
            document.getElementById('modal-image').onerror = function() {
                this.src = '/api/placeholder/250/250';
            };
            
            // Store the selected Chilean for later use
            selectedChilean = chilean;
            
            // Show the modal
            document.getElementById('chilean-modal').style.display = 'flex';
        }
        
        // Create question containers
        function createQuestions() {
            const questionsArea = document.getElementById('questions-area');
            questionsArea.innerHTML = '';
            
            questions.forEach((question) => {
                const questionContainer = document.createElement('div');
                questionContainer.className = 'question-container';
                questionContainer.id = question.id;
                
                const questionText = document.createElement('div');
                questionText.className = 'question';
                questionText.textContent = question.text;
                questionContainer.appendChild(questionText);
                
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options';
                
                // Shuffle options for more variety
                const shuffledOptions = shuffleArray([...question.options]);
                
                shuffledOptions.forEach((option) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.textContent = option.text;
                    optionElement.setAttribute('data-value', option.value);
                    optionElement.setAttribute('data-category', option.category);
                    
                    optionElement.addEventListener('click', function() {
                        // Remove 'selected' class from all options in this question
                        questionContainer.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // Add 'selected' class to clicked option
                        this.classList.add('selected');
                        
                        // Enable next button
                        document.getElementById('next-button').disabled = false;
                    });
                    
                    optionsContainer.appendChild(optionElement);
                });
                
                questionContainer.appendChild(optionsContainer);
                questionsArea.appendChild(questionContainer);
            });
        }
        
        // Fisher-Yates shuffle algorithm for options
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Show a specific question
        function showQuestion(index) {
            // Hide all questions
            document.querySelectorAll('.question-container').forEach(q => {
                q.style.display = 'none';
            });
            
            // Show current question
            document.getElementById(questions[index].id).style.display = 'block';
            
            // Update question counter
            document.getElementById('current-question-label').textContent = `${index + 1} of ${totalQuestions}`;
            
            // Enable/disable back button
            document.getElementById('back-button').disabled = (index === 0);
            
            // Check if option already selected
            const selectedOption = document.getElementById(questions[index].id).querySelector('.option.selected');
            document.getElementById('next-button').disabled = !selectedOption;
        }
        
        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }
        
        // Find matching Chilean
        function findMatchingChilean(traits) {
            let matchScores = chileans.map(chilean => {
                let score = 0;
                let matchedTraits = [];
                let matchReasons = [];
                
                // Score direct trait matches
                for (const category in traits) {
                    if (chilean.traits[category] === traits[category]) {
                        score += 10;
                        matchedTraits.push({
                            category: category,
                            value: traits[category],
                            match: "exact"
                        });
                        matchReasons.push(`Your ${category} style (${traits[category]}) exactly matches ${chilean.name}'s approach to life.`);
                    }
                    // Score related traits
                    else if (chilean.relatedTraits && 
                             chilean.relatedTraits[category] && 
                             chilean.relatedTraits[category].includes(traits[category])) {
                        score += 5;
                        matchedTraits.push({
                            category: category,
                            value: traits[category],
                            related: true
                        });
                        matchReasons.push(`Your ${category} (${traits[category]}) resonates with ${chilean.name}'s personality.`);
                    }
                }
                
                // Add some randomness for more variety (but still weighted toward best matches)
                score += Math.random() * 2;
                
                return {
                    chilean: chilean,
                    score: score,
                    matchedTraits: matchedTraits,
                    matchReasons: matchReasons
                };
            });
            
            // Sort by score (highest first)
            matchScores.sort((a, b) => b.score - a.score);
            
            // Return the best match
            return matchScores[0];
        }
        
        // Show result profile
        function showResult() {
            const bestMatch = findMatchingChilean(userTraits);
            const chilean = bestMatch.chilean;
            
            // Update profile information
            document.getElementById('chilean-image').src = chilean.image;
            document.getElementById('chilean-image').alt = chilean.name;
            document.getElementById('chilean-name').textContent = chilean.name;
            document.getElementById('chilean-zodiac').textContent = chilean.zodiac;
            document.getElementById('chilean-description').textContent = chilean.description;
            
            // Add error handling for result image
            document.getElementById('chilean-image').onerror = function() {
                this.src = '/api/placeholder/250/250';
            };
            
            // Set category badge
            const categoryBadge = document.getElementById('chilean-category');
            if (categoryBadge) {
                categoryBadge.textContent = chilean.category.replace('_', ' ');
            }
            
            // Generate match explanation
            let matchExplanation = `You and ${chilean.name} share a similar outlook on life. `;
            
            if (bestMatch.matchReasons.length > 0) {
                // Add a couple of random reasons for the match
                const selectedReasons = shuffleArray([...bestMatch.matchReasons]).slice(0, Math.min(2, bestMatch.matchReasons.length));
                matchExplanation += selectedReasons.join(' ');
            }
            
            document.getElementById('match-explanation').textContent = matchExplanation;
            
            // Add matched traits
            const matchTraitsContainer = document.getElementById('match-traits');
            matchTraitsContainer.innerHTML = '';
            
            bestMatch.matchedTraits.forEach(trait => {
                const traitBadge = document.createElement('div');
                traitBadge.className = 'trait-badge';
                traitBadge.textContent = trait.value;
                matchTraitsContainer.appendChild(traitBadge);
            });
            
            // Display the profile
            document.getElementById('profile').style.display = 'flex';
        }
        
        // Set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Start button
            document.getElementById('start-button').addEventListener('click', function() {
                document.getElementById('intro-container').style.display = 'none';
                document.getElementById('quiz-container').style.display = 'block';
                createQuestions();
                showQuestion(0);
                updateProgressBar();
            });
            
            // View gallery button
            document.getElementById('view-gallery-button').addEventListener('click', function() {
                document.getElementById('intro-container').style.display = 'none';
                document.getElementById('gallery-container').style.display = 'flex';
                initGallery();
            });
            
            // Back to intro button
            document.getElementById('back-to-intro-button').addEventListener('click', function() {
                document.getElementById('gallery-container').style.display = 'none';
                document.getElementById('intro-container').style.display = 'block';
            });
            
            // Close modal button
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('chilean-modal').style.display = 'none';
            });
            
            // When clicking outside the modal content, close the modal
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('chilean-modal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Choose Chilean button
            document.getElementById('choose-chilean-button').addEventListener('click', function() {
                if (selectedChilean) {
                    document.getElementById('chilean-modal').style.display = 'none';
                    document.getElementById('gallery-container').style.display = 'none';
                    
                    // Update profile information
                    document.getElementById('chilean-image').src = selectedChilean.image;
                    document.getElementById('chilean-image').alt = selectedChilean.name;
                    document.getElementById('chilean-name').textContent = selectedChilean.name;
                    document.getElementById('chilean-zodiac').textContent = selectedChilean.zodiac;
                    document.getElementById('chilean-description').textContent = selectedChilean.description;
                    
                    // Set category badge
                    const categoryBadge = document.getElementById('chilean-category');
                    if (categoryBadge) {
                        categoryBadge.textContent = selectedChilean.category.replace('_', ' ');
                    }
                    
                    // Clear match traits
                    document.getElementById('match-traits').innerHTML = '';
                    
                    // Set match explanation
                    document.getElementById('match-explanation').textContent = `You've chosen ${selectedChilean.name} as your Chilean spirit guide. A bold choice that reveals your excellent taste!`;
                    
                    // Display the profile
                    document.getElementById('profile').style.display = 'flex';
                }
            });
            
            // Next button
            document.getElementById('next-button').addEventListener('click', function() {
                const currentQuestionElement = document.getElementById(questions[currentQuestion].id);
                const selectedOption = currentQuestionElement.querySelector('.option.selected');
                
                if (!selectedOption) {
                    alert('Please select an option to continue.');
                    return;
                }
                
                // Store the selected trait
                const traitCategory = selectedOption.getAttribute('data-category');
                const traitValue = selectedOption.getAttribute('data-value');
                userTraits[traitCategory] = traitValue;
                
                currentQuestionElement.style.display = 'none';
                
                if (currentQuestion < totalQuestions - 1) {
                    currentQuestion++;
                    showQuestion(currentQuestion);
                    updateProgressBar();
                } else {
                    // Show result
                    document.getElementById('quiz-container').style.display = 'none';
                    showResult();
                }
            });
            
            // Back button
            document.getElementById('back-button').addEventListener('click', function() {
                if (currentQuestion > 0) {
                    // Hide current question
                    document.getElementById(questions[currentQuestion].id).style.display = 'none';
                    
                    // Show previous question
                    currentQuestion--;
                    showQuestion(currentQuestion);
                    updateProgressBar();
                    
                    // Disable back button if at first question
                    this.disabled = (currentQuestion === 0);
                }
            });
            
            // Restart button
            document.getElementById('restart-button').addEventListener('click', function() {
                // Reset quiz
                document.getElementById('profile').style.display = 'none';
                document.getElementById('intro-container').style.display = 'block';
                currentQuestion = 0;
                userTraits = {};
                
                // Clear match traits
                document.getElementById('match-traits').innerHTML = '';
            });
            
            // Share button
            document.getElementById('share-button').addEventListener('click', function() {
                const chileanName = document.getElementById('chilean-name').textContent;
                alert(`I got matched with ${chileanName} as my Chilean Spirit Guide!`);
            });
            
            // Handle fallback for missing images
            window.addEventListener('error', function(e) {
                if (e.target.tagName.toLowerCase() === 'img') {
                    e.target.src = '/api/placeholder/250/250';
                }
            }, true);
        });
    </script>
</body>
</html>
